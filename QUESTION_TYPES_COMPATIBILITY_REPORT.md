# é¢˜å‹å…¼å®¹æ€§æ£€æŸ¥æŠ¥å‘Š

## æ£€æŸ¥æ—¶é—´
2025-11-04

## æ£€æŸ¥èŒƒå›´
- åˆ¤æ–­é¢˜ (Judge)
- å¡«ç©ºé¢˜ (Fill-in-the-blank)
- é—®ç­”é¢˜ (Essay)

---

## âœ… å‰ç«¯UIå…¼å®¹æ€§

### åˆ¤æ–­é¢˜ (Judge)
**çŠ¶æ€**: âœ… å®Œå…¨æ”¯æŒ

**UIå®ç°** (`question_card.dart:970-1065`):
- æä¾›"æ­£ç¡®"å’Œ"é”™è¯¯"ä¸¤ä¸ªé€‰é¡¹
- ç”¨æˆ·ç‚¹å‡»é€‰æ‹©ç­”æ¡ˆ
- æäº¤åä¿å­˜ä¸ºå­—ç¬¦ä¸² `'true'` æˆ– `'false'`
- è§†è§‰æ•ˆæœè‰¯å¥½ï¼Œç»¿è‰²/çº¢è‰²å›¾æ ‡é…è‰²

**æ•°æ®æ ¼å¼**:
```dart
// ä¿å­˜æ ¼å¼
_saveAnswer('true')  // æˆ– 'false'

// åˆå§‹åŒ–æ—¶è½¬æ¢
if (savedAnswer is bool) {
  _judgeAnswer = savedAnswer;
} else if (savedAnswer is String) {
  _judgeAnswer = savedAnswer == 'true';
}
```

### å¡«ç©ºé¢˜ (Fill-in-the-blank)
**çŠ¶æ€**: âœ… åŸºæœ¬æ”¯æŒ

**UIå®ç°** (`question_card.dart:1066-1094`):
- æä¾›æ–‡æœ¬è¾“å…¥æ¡†
- æ”¯æŒå¤šä¸ªç©ºæ ¼
- ä½¿ç”¨ `TextEditingController` æ•°ç»„ç®¡ç†
- ç­”æ¡ˆä¿å­˜ä¸ºå­—ç¬¦ä¸²åˆ—è¡¨

**æ•°æ®æ ¼å¼**:
```dart
// ä¿å­˜æ ¼å¼
_saveAnswer(['ç­”æ¡ˆ1', 'ç­”æ¡ˆ2', 'ç­”æ¡ˆ3'])

// æ§åˆ¶å™¨æ•°é‡é»˜è®¤ä¸º1ï¼Œå¯èƒ½éœ€è¦æ ¹æ®é¢˜ç›®å†…å®¹è§£æç©ºæ ¼æ•°é‡
```

**âš ï¸ æ³¨æ„äº‹é¡¹**:
- ç›®å‰ç©ºæ ¼æ•°é‡é»˜è®¤ä¸º1ï¼Œå¯èƒ½éœ€è¦ä»é¢˜å¹²ä¸­è§£æ `____` çš„æ•°é‡
- å»ºè®®åœ¨åˆ›å»ºé¢˜ç›®æ—¶æ˜ç¡®æŒ‡å®šç©ºæ ¼æ•°é‡

### é—®ç­”é¢˜ (Essay)
**çŠ¶æ€**: âœ… åŸºæœ¬æ”¯æŒ

**UIå®ç°** (`question_card.dart:1096-1110`):
- æä¾›å¤šè¡Œæ–‡æœ¬è¾“å…¥æ¡†ï¼ˆ8è¡Œï¼‰
- ä½¿ç”¨å•ä¸ª `TextEditingController`
- ç­”æ¡ˆä¿å­˜ä¸ºå­—ç¬¦ä¸²

**æ•°æ®æ ¼å¼**:
```dart
// ä¿å­˜æ ¼å¼
_saveAnswer('ç”¨æˆ·çš„é—®ç­”å†…å®¹')
```

---

## âœ… åç«¯APIå…¼å®¹æ€§

### åˆ¤æ–­é¢˜å¤„ç† (`practice.py:587-588`)
**çŠ¶æ€**: âœ… å®Œå…¨æ”¯æŒ

```python
elif question.type == QuestionType.judge:
    is_correct = user_answer.get("answer") == correct_answer.get("answer")
```

**æœŸæœ›æ•°æ®ç»“æ„**:
- `correct_answer`: `{"answer": true}` æˆ– `{"answer": false}`
- `user_answer`: `{"answer": "true"}` æˆ– `{"answer": "false"}`

**âš ï¸ å‘ç°é—®é¢˜**: ç±»å‹ä¸åŒ¹é…
- å‰ç«¯å‘é€å­—ç¬¦ä¸²: `"true"/"false"`
- åç«¯å­˜å‚¨å¸ƒå°”å€¼: `true/false`
- æ¯”è¾ƒä¼šå¤±è´¥ï¼

### å¡«ç©ºé¢˜å¤„ç† (`practice.py:590-592`)
**çŠ¶æ€**: âš ï¸ éœ€è¦æ”¹è¿›

```python
elif question.type in [QuestionType.fill, QuestionType.essay]:
    # å¯ä»¥åŠ å…¥å…³é”®è¯åŒ¹é…æˆ–AIåˆ¤æ–­
    is_correct = False  # é»˜è®¤éœ€è¦äººå·¥è¯„åˆ¤
```

**å½“å‰é—®é¢˜**:
- æ‰€æœ‰å¡«ç©ºé¢˜ç­”æ¡ˆé»˜è®¤æ ‡è®°ä¸ºé”™è¯¯
- æ²¡æœ‰å®ç°ç­”æ¡ˆåŒ¹é…é€»è¾‘
- éœ€è¦æ·»åŠ å­—ç¬¦ä¸²æ¯”è¾ƒæˆ–å…³é”®è¯åŒ¹é…

### é—®ç­”é¢˜å¤„ç† (`practice.py:590-592`)
**çŠ¶æ€**: âš ï¸ éœ€è¦æ”¹è¿›

**å½“å‰é—®é¢˜**:
- æ‰€æœ‰é—®ç­”é¢˜ç­”æ¡ˆé»˜è®¤æ ‡è®°ä¸ºé”™è¯¯
- ç¼ºå°‘å…³é”®è¯åŒ¹é…åŠŸèƒ½
- å»ºè®®ï¼šä¿æŒå½“å‰é€»è¾‘ï¼ˆéœ€äººå·¥è¯„åˆ¤ï¼‰ï¼Œæˆ–æ·»åŠ å…³é”®è¯è¯„åˆ†ç³»ç»Ÿ

---

## ğŸ”§ éœ€è¦ä¿®å¤çš„é—®é¢˜

### é—®é¢˜1: åˆ¤æ–­é¢˜ç±»å‹ä¸åŒ¹é… [HIGH PRIORITY]

**ä½ç½®**: `question_card.dart:979, 983`

**å½“å‰ä»£ç **:
```dart
_saveAnswer('true');  // å­—ç¬¦ä¸²
```

**åç«¯æœŸæœ›**:
```python
correct_answer.get("answer")  // bool
```

**ä¿®å¤æ–¹æ¡ˆ**: ä¿®æ”¹å‰ç«¯ä¿å­˜æ ¼å¼ä¸ºå¸ƒå°”å€¼

### é—®é¢˜2: å¡«ç©ºé¢˜æ²¡æœ‰ç­”æ¡ˆæ ¡éªŒ [MEDIUM PRIORITY]

**ä½ç½®**: `practice.py:590-592`

**ä¿®å¤æ–¹æ¡ˆ**: å®ç°åŸºæœ¬çš„å­—ç¬¦ä¸²åŒ¹é…é€»è¾‘
```python
elif question.type == QuestionType.fill:
    # è·å–æ ‡å‡†ç­”æ¡ˆ
    blanks = correct_answer.get("blanks", [])
    user_blanks = user_answer.get("answers", [])

    # é€ä¸ªæ¯”å¯¹å¡«ç©ºç­”æ¡ˆï¼ˆå¿½ç•¥å¤§å°å†™å’Œé¦–å°¾ç©ºæ ¼ï¼‰
    is_correct = True
    for i, blank in enumerate(blanks):
        if i >= len(user_blanks):
            is_correct = False
            break
        user_ans = user_blanks[i].strip().lower()
        correct_ans = blank.get("answer", "").strip().lower()
        alternatives = [alt.strip().lower() for alt in blank.get("alternatives", [])]

        if user_ans != correct_ans and user_ans not in alternatives:
            is_correct = False
            break
```

### é—®é¢˜3: é—®ç­”é¢˜è¯„åˆ¤é€»è¾‘ç¼ºå¤± [LOW PRIORITY]

**å»ºè®®**: ä¿æŒå½“å‰çŠ¶æ€ï¼ˆæ ‡è®°ä¸ºFalseéœ€äººå·¥è¯„åˆ¤ï¼‰ï¼Œæˆ–è€…ï¼š
- æ·»åŠ å…³é”®è¯åŒ¹é…è¯„åˆ†ç³»ç»Ÿ
- é›†æˆAIè¯„åˆ¤æ¥å£
- æä¾›æ•™å¸ˆæ‰¹æ”¹åŠŸèƒ½

---

## ğŸ“‹ æ•°æ®ç»“æ„è§„èŒƒ

### åˆ¤æ–­é¢˜
```json
{
  "type": "judge",
  "meta_data": {
    "answer": true  // boolean
  },
  "correct_answer": {
    "answer": true  // boolean
  }
}
```

### å¡«ç©ºé¢˜
```json
{
  "type": "fill",
  "meta_data": {
    "blanks": [
      {
        "position": 0,
        "answer": "æ ‡å‡†ç­”æ¡ˆ",
        "alternatives": ["å¤‡é€‰ç­”æ¡ˆ1", "å¤‡é€‰ç­”æ¡ˆ2"]
      }
    ]
  },
  "correct_answer": {
    "blanks": [...]  // åŒä¸Š
  }
}
```

### é—®ç­”é¢˜
```json
{
  "type": "essay",
  "meta_data": {
    "reference_answer": "å‚è€ƒç­”æ¡ˆ",
    "keywords": ["å…³é”®è¯1", "å…³é”®è¯2"]
  },
  "correct_answer": {
    "reference_answer": "å‚è€ƒç­”æ¡ˆ",
    "keywords": [...]
  }
}
```

---

## ğŸ¯ ä¿®å¤ä¼˜å…ˆçº§

1. **HIGH**: ä¿®å¤åˆ¤æ–­é¢˜ç±»å‹ä¸åŒ¹é…é—®é¢˜
2. **MEDIUM**: å®ç°å¡«ç©ºé¢˜ç­”æ¡ˆæ ¡éªŒ
3. **LOW**: å®Œå–„é—®ç­”é¢˜è¯„åˆ¤ï¼ˆå¯é€‰ï¼‰

---

## âœ… æµ‹è¯•å»ºè®®

### åˆ¤æ–­é¢˜æµ‹è¯•
1. åˆ›å»ºåˆ¤æ–­é¢˜ï¼Œè®¾ç½®ç­”æ¡ˆä¸º"æ­£ç¡®"
2. ç”¨æˆ·é€‰æ‹©"æ­£ç¡®"ï¼Œæäº¤
3. éªŒè¯è¿”å› `is_correct: true`

### å¡«ç©ºé¢˜æµ‹è¯•
1. åˆ›å»ºåŒ…å«2ä¸ªç©ºæ ¼çš„å¡«ç©ºé¢˜
2. å¡«å†™æ­£ç¡®ç­”æ¡ˆ
3. éªŒè¯ç­”æ¡ˆåŒ¹é…é€»è¾‘
4. æµ‹è¯•å¤§å°å†™å’Œç©ºæ ¼å¤„ç†

### é—®ç­”é¢˜æµ‹è¯•
1. åˆ›å»ºé—®ç­”é¢˜ï¼Œè®¾ç½®å‚è€ƒç­”æ¡ˆå’Œå…³é”®è¯
2. ç”¨æˆ·ä½œç­”
3. éªŒè¯ç³»ç»Ÿåé¦ˆï¼ˆå½“å‰åº”ä¸º"éœ€äººå·¥è¯„åˆ¤"ï¼‰

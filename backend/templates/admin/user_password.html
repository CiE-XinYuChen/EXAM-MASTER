{% extends "admin/base.html" %}

{% block title %}修改密码{% endblock %}

{% block breadcrumb %}
<a href="/admin">首页</a>
<span>/</span>
<a href="/admin/users">用户管理</a>
<span>/</span>
修改密码
{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h3 class="card-title">
            修改用户密码 - {{ user.username }}
        </h3>
    </div>
    <div class="card-body">
        <!-- 用户信息 -->
        <div style="background: #f7f8fa; padding: 15px; border-radius: 4px; margin-bottom: 20px;">
            <h4 style="margin-bottom: 10px;">用户信息</h4>
            <table>
                <tbody>
                    <tr>
                        <td style="padding-right: 20px;"><strong>用户名：</strong></td>
                        <td>{{ user.username }}</td>
                    </tr>
                    <tr>
                        <td style="padding-right: 20px;"><strong>邮箱：</strong></td>
                        <td>{{ user.email }}</td>
                    </tr>
                    <tr>
                        <td style="padding-right: 20px;"><strong>角色：</strong></td>
                        <td>
                            {% if user.role.value == 'admin' %}
                                <span class="tag tag-red">管理员</span>
                            {% elif user.role.value == 'teacher' %}
                                <span class="tag tag-blue">教师</span>
                            {% else %}
                                <span class="tag tag-green">学生</span>
                            {% endif %}
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- 密码修改表单 -->
        <form method="POST" action="/admin/users/{{ user.id }}/password">
            <div class="form-group">
                <label class="form-label" for="new_password">新密码 *</label>
                <input type="password" 
                       id="new_password" 
                       name="new_password" 
                       class="form-control"
                       minlength="6"
                       required>
                <small style="display: block; margin-top: 5px; color: #666;">
                    密码至少6个字符，建议使用字母、数字和特殊字符的组合
                </small>
            </div>
            
            <div class="form-group">
                <label class="form-label" for="confirm_password">确认新密码 *</label>
                <input type="password" 
                       id="confirm_password" 
                       name="confirm_password" 
                       class="form-control"
                       minlength="6"
                       required>
            </div>
            
            <div class="form-group">
                <label>
                    <input type="checkbox" id="show_password" onchange="togglePasswordVisibility()">
                    显示密码
                </label>
            </div>
            
            {% if error %}
            <div class="alert alert-danger" style="margin-bottom: 20px;">
                <i class="fas fa-exclamation-circle"></i> {{ error }}
            </div>
            {% endif %}
            
            {% if success %}
            <div class="alert alert-success" style="margin-bottom: 20px;">
                <i class="fas fa-check-circle"></i> {{ success }}
            </div>
            {% endif %}
            
            <div class="btn-group">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save"></i> 修改密码
                </button>
                <a href="/admin/users" class="btn btn-default">
                    <i class="fas fa-arrow-left"></i> 返回列表
                </a>
                <a href="/admin/users/{{ user.id }}/edit" class="btn btn-default">
                    <i class="fas fa-edit"></i> 编辑用户
                </a>
            </div>
        </form>
    </div>
</div>

<!-- 安全提示 -->
<div class="card" style="margin-top: 20px;">
    <div class="card-header">
        <h3 class="card-title">安全提示</h3>
    </div>
    <div class="card-body">
        <ul style="line-height: 1.8;">
            <li>作为管理员，您可以直接为用户重置密码，无需知道原密码</li>
            <li>修改密码后，用户需要使用新密码重新登录</li>
            <li>请确保将新密码安全地告知用户</li>
            <li>建议用户在首次登录后立即修改密码</li>
        </ul>
    </div>
</div>

<script>
// 密码确认验证
document.querySelector('form').addEventListener('submit', function(e) {
    const newPassword = document.getElementById('new_password').value;
    const confirmPassword = document.getElementById('confirm_password').value;
    
    if (newPassword !== confirmPassword) {
        e.preventDefault();
        alert('两次输入的密码不一致！');
        return false;
    }
    
    if (newPassword.length < 6) {
        e.preventDefault();
        alert('密码长度至少为6个字符！');
        return false;
    }
});

// 显示/隐藏密码
function togglePasswordVisibility() {
    const showPassword = document.getElementById('show_password').checked;
    const newPasswordInput = document.getElementById('new_password');
    const confirmPasswordInput = document.getElementById('confirm_password');
    
    if (showPassword) {
        newPasswordInput.type = 'text';
        confirmPasswordInput.type = 'text';
    } else {
        newPasswordInput.type = 'password';
        confirmPasswordInput.type = 'password';
    }
}
</script>
{% endblock %}